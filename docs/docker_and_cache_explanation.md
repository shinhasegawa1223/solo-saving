# Dockerとキャッシュの仕組み（やさしく解説）

## 1. Dockerの「マルチステージビルド」って？

**目的：アプリを軽く、安全にするため**

料理に例えると…
1. **キッチン（ビルド環境）**: まな板、包丁、皮、生ゴミがある（散らかっている）
2. **食卓（本番環境）**: 完成した料理だけがある（キレイ）

Dockerでも同じように、**「作る場所」と「動かす場所」**を分けます。

```dockerfile
# 1. 作る場所（キッチン）
# 道具がいっぱい入った重いイメージを使って、アプリをビルドします
FROM node:20 AS builder
...
RUN npm run build

# 2. 動かす場所（食卓）
# 必要最小限の軽いイメージを使います
FROM node:20-alpine AS runner
...
# キッチンから完成品だけを持ってきます
COPY --from=builder /app/dist ./dist
```

### どうしてこれやるの？
- **軽いから**: 不要な道具（ビルドツール）を捨てるので、数百MBも軽くなります。
- **安全だから**: 開発用のコードやツールが本番に残らないので、攻撃されにくくなります。

---

## 2. GitHub Actionsの「キャッシュ」って？

**目的：テストやデプロイを速く、安くするため**

### なぜ必要？
Playwright（テスト用ブラウザ）のダウンロードは、毎回やると **500MB以上** あります。
これを毎回ゼロからダウンロードしていると…
- **時間がかかる**: 毎回5〜10分待たされる
- **お金がかかる**: GitHub Actionsは動いている時間で課金される

### 解決策：キャッシュ（一時保存）
「一度ダウンロードしたブラウザは、次回も使い回す」という設定をします。

```yaml
- name: Cache Playwright browsers
  uses: actions/cache@v4
  # ...（保存場所の設定など）
```

**結果**: ダウンロード時間がゼロになり、テストがサクサク終わるようになります！

---

## 3. まとめ

| 技術 | ひとことで言うと | メリット |
|------|------------------|----------|
| **Dockerマルチステージ** | **「調理場と食卓を分ける」** | アプリが軽くなり、セキュリティも向上 |
| **GitHub Actionsキャッシュ** | **「道具を使い回す」** | 待ち時間が減り、節約になる |

> **共通の思想**: 「無駄を省いて、シンプルに保つ」
