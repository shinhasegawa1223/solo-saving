# GitHub Actions ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚·ãƒ¥å›ºå®š

## ğŸ¯ ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›®çš„

GitHub Actionsã§ä½¿ç”¨ã™ã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ã€**ãªãœã€Œãƒãƒƒã‚·ãƒ¥å›ºå®šï¼ˆãƒ”ãƒ³ãƒ‹ãƒ³ã‚°ï¼‰ã€ãŒå¿…è¦ãªã®ã‹**ã‚’å®Ÿéš›ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆäº‹ä¾‹ã¨ã¨ã‚‚ã«è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸš¨ å®Ÿéš›ã«èµ·ããŸã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆäº‹ä¾‹

### äº‹ä¾‹1: ãƒ¡ãƒ«ã‚«ãƒª Ã— Codecoväº‹ä»¶ï¼ˆ2021å¹´ï¼‰

> [!CAUTION]
> **ç´„27,000ä»¶ä»¥ä¸Šã®å€‹äººæƒ…å ±ãŒæµå‡º**

#### ä½•ãŒèµ·ããŸã‹ï¼Ÿ

```mermaid
graph LR
    A[æ”»æ’ƒè€…] -->|1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ”¹ã–ã‚“| B[Codecov Bash Uploader]
    B -->|2. CIå®Ÿè¡Œæ™‚ã«å®Ÿè¡Œ| C[ãƒ¡ãƒ«ã‚«ãƒªã®CIç’°å¢ƒ]
    C -->|3. èªè¨¼æƒ…å ±ã‚’å¤–éƒ¨é€ä¿¡| D[æ”»æ’ƒè€…ã‚µãƒ¼ãƒãƒ¼]
    D -->|4. GitHubã«ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹| E[ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æµå‡º]
```

1. **2021å¹´1æœˆ**: æ”»æ’ƒè€…ãŒCodecovã®Bash Uploaderã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ”¹ã–ã‚“
2. **æ”¹ã–ã‚“ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: CIå®Ÿè¡Œæ™‚ã«ç’°å¢ƒå¤‰æ•°ï¼ˆAPIã‚­ãƒ¼ã€ãƒˆãƒ¼ã‚¯ãƒ³ç­‰ï¼‰ã‚’å¤–éƒ¨ã«é€ä¿¡
3. **ãƒ¡ãƒ«ã‚«ãƒªã¸ã®å½±éŸ¿**: GitHubèªè¨¼æƒ…å ±ãŒæ¼æ´© â†’ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ»é¡§å®¢æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹

#### æµå‡ºã—ãŸæƒ…å ±

| ã‚«ãƒ†ã‚´ãƒª | ä»¶æ•° | å†…å®¹ |
|:---|---:|:---|
| éŠ€è¡Œå£åº§æƒ…å ± | 17,085ä»¶ | å£åº§ç•ªå·ã€åç¾©ãªã© |
| ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆæƒ…å ± | 230ä»¶ | æ°åã€ä½æ‰€ã€å•ã„åˆã‚ã›å†…å®¹ |
| åŠ ç›Ÿåº—æƒ…å ± | 7,925ä»¶ | å€‹äººäº‹æ¥­ä¸»å |
| å¾“æ¥­å“¡æƒ…å ± | 2,640ä»¶ | ç¤¾å“¡IDã€é›»è©±ç•ªå·ãªã© |

> ğŸ“š å‚è€ƒ: [ãƒ¡ãƒ«ã‚«ãƒªå…¬å¼ç™ºè¡¨](https://about.mercari.com/press/news/articles/20210521_incident_report/)

---

### äº‹ä¾‹2: tj-actions/changed-filesäº‹ä»¶ï¼ˆ2025å¹´3æœˆï¼‰

> [!CAUTION]
> **23,000ä»¥ä¸Šã®ãƒªãƒã‚¸ãƒˆãƒªã«å½±éŸ¿ã€CISAãŒç·Šæ€¥è­¦å‘Šã‚’ç™ºä»¤**

#### ä½•ãŒèµ·ããŸã‹ï¼Ÿ

```mermaid
graph TD
    A[æ”»æ’ƒè€…] -->|PATçªƒå–| B[tj-actions-botã‚¢ã‚«ã‚¦ãƒ³ãƒˆ]
    B -->|æ‚ªæ„ã‚ã‚‹ã‚³ãƒŸãƒƒãƒˆ| C[tj-actions/changed-files]
    C -->|å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã‚’æ›¸ãæ›ãˆ| D["@v1 @v2 @v35 ç­‰ã™ã¹ã¦"]
    D -->|CIå®Ÿè¡Œ| E[è¢«å®³è€…ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼]
    E -->|ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ¼æ´©| F[æ”»æ’ƒè€…ãŒAWSã‚­ãƒ¼ç­‰ã‚’å–å¾—]
```

#### ç‰¹ã«æ·±åˆ»ã ã£ãŸç‚¹

- **å…¨ã¦ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ãŒæ”¹ã–ã‚“**: `@v1` ã‹ã‚‰ `@v35` ã¾ã§å…¨ã¦ãŒæ‚ªæ„ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡ã™ã‚ˆã†ã«å¤‰æ›´ã•ã‚ŒãŸ
- **ã‚¿ã‚°å›ºå®šã§ã¯é˜²ã’ãªã‹ã£ãŸ**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ã‚’æŒ‡å®šã—ã¦ã„ã¦ã‚‚æ”»æ’ƒã‚’å—ã‘ãŸ
- **å”¯ä¸€ã®é˜²å¾¡ç­–**: **ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã§ã®å›ºå®š**

```yaml
# âŒ ã“ã‚Œã§ã¯é˜²ã’ãªã‹ã£ãŸ
- uses: tj-actions/changed-files@v35

# âœ… ãƒãƒƒã‚·ãƒ¥å›ºå®šãªã‚‰å½±éŸ¿ãªã—
- uses: tj-actions/changed-files@abc123...
```

---

## ğŸ’¡ ãªãœãƒãƒƒã‚·ãƒ¥å›ºå®šãŒå¿…è¦ï¼Ÿ

### ğŸ·ï¸ ã‚¿ã‚°ã¯ã€Œä»˜ç®‹ã€ã€ãƒãƒƒã‚·ãƒ¥ã¯ã€ŒDNAã€

**åˆå¿ƒè€…å‘ã‘ã®ä¾‹ãˆè©±ã§ç†è§£ã—ã‚ˆã†ï¼**

#### ã‚¿ã‚°ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰= ä»˜ç®‹ï¼ˆè²¼ã‚Šç›´ã—ã§ãã‚‹ï¼‰

ã‚¿ã‚°ã¯æœ¬ã«è²¼ã‚‹**ä»˜ç®‹**ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

```
ğŸ“š æœ¬æ£šã®ã‚¤ãƒ¡ãƒ¼ã‚¸:
   [è‰¯ã„æœ¬] â† ã€Œv4ã€ã¨ã„ã†ä»˜ç®‹ãŒè²¼ã£ã¦ã‚ã‚‹

   æ”»æ’ƒè€…ãŒæ¥ã¦...

   [è‰¯ã„æœ¬]     [æ‚ªã„æœ¬]
      â†“           â†‘
   ä»˜ç®‹ã‚’å‰¥ãŒã—ã¦ã€æ‚ªã„æœ¬ã«è²¼ã‚Šç›´ã™ï¼

   [è‰¯ã„æœ¬]  [æ‚ªã„æœ¬] â† ã€Œv4ã€ã®ä»˜ç®‹
```

ã‚ãªãŸãŒã€Œv4ã®æœ¬ã‚’ãã ã•ã„ã€ã¨è¨€ã£ã¦ã‚‚ã€**ä»˜ç®‹ãŒè²¼ã‚Šæ›¿ãˆã‚‰ã‚Œã¦ã„ãŸã‚‰æ‚ªã„æœ¬ã‚’æ¸¡ã•ã‚Œã‚‹**ã®ã§ã™ã€‚

#### ãƒãƒƒã‚·ãƒ¥ï¼ˆSHAï¼‰= DNAï¼ˆå¤‰æ›´ä¸å¯èƒ½ï¼‰

ãƒãƒƒã‚·ãƒ¥ã¯**äººé–“ã®DNA**ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚

```
ğŸ‘¤ äººé–“ã®DNA:
   Aã•ã‚“ã®è¦‹ãŸç›®ãƒ»æ€§æ ¼ãƒ»å£° â†’ DNA: abc123...

   ã‚‚ã—èª°ã‹ãŒAã•ã‚“ã«ãªã‚Šã™ã¾ãã†ã¨ã—ã¦ã‚‚...
   - é¡”ã‚’æ•´å½¢ã—ã¦ã‚‚ â†’ DNAã¯å¤‰ã‚ã‚‰ãªã„
   - å£°ã‚’çœŸä¼¼ã—ã¦ã‚‚ â†’ DNAã¯å¤‰ã‚ã‚‰ãªã„

   DNAæ¤œæŸ»ã‚’ã™ã‚Œã°ã€æœ¬ç‰©ã‹ã©ã†ã‹100%ã‚ã‹ã‚‹ï¼
```

**ã‚³ãƒ¼ãƒ‰ã‚‚åŒã˜ã§ã™:**

```
è‰¯ã„ã‚³ãƒ¼ãƒ‰: console.log("hello")  â†’ ãƒãƒƒã‚·ãƒ¥: abc123...
æ‚ªã„ã‚³ãƒ¼ãƒ‰: stealSecrets()        â†’ ãƒãƒƒã‚·ãƒ¥: xyz789...ï¼ˆçµ¶å¯¾ã«é•ã†å€¤ã«ãªã‚‹ï¼‰
```

> [!IMPORTANT]
> **ãƒãƒƒã‚·ãƒ¥ã¯ã‚³ãƒ¼ãƒ‰ã®ã€Œå†…å®¹ã€ã‹ã‚‰è¨ˆç®—ã•ã‚Œã‚‹å›ºæœ‰ã®å€¤ã§ã™ã€‚**
> 1æ–‡å­—ã§ã‚‚å¤‰æ›´ã™ã‚‹ã¨ã€ãƒãƒƒã‚·ãƒ¥ã¯å®Œå…¨ã«åˆ¥ã®å€¤ã«ãªã‚Šã¾ã™ã€‚
> ã ã‹ã‚‰æ”»æ’ƒè€…ãŒæ‚ªã„ã‚³ãƒ¼ãƒ‰ã§åŒã˜ãƒãƒƒã‚·ãƒ¥ã‚’ä½œã‚‹ã“ã¨ã¯**æ•°å­¦çš„ã«ä¸å¯èƒ½**ãªã®ã§ã™ã€‚

#### ãªãœæ”»æ’ƒè€…ã¯åŒã˜ãƒãƒƒã‚·ãƒ¥ã‚’ä½œã‚Œãªã„ã®ï¼Ÿ

```mermaid
graph TD
    A["ã‚³ãƒ¼ãƒ‰ã®å†…å®¹"] -->|SHA-1è¨ˆç®—| B["40æ–‡å­—ã®ãƒãƒƒã‚·ãƒ¥"]
    C["1æ–‡å­—ã§ã‚‚é•ã†ã‚³ãƒ¼ãƒ‰"] -->|SHA-1è¨ˆç®—| D["å®Œå…¨ã«åˆ¥ã®ãƒãƒƒã‚·ãƒ¥"]
```

- ãƒãƒƒã‚·ãƒ¥ã¯**ä¸€æ–¹é€šè¡Œã®è¨ˆç®—**ã§ã™ï¼ˆã‚³ãƒ¼ãƒ‰ â†’ ãƒãƒƒã‚·ãƒ¥ã¯ç°¡å˜ã€ãƒãƒƒã‚·ãƒ¥ â†’ ã‚³ãƒ¼ãƒ‰ã¯ä¸å¯èƒ½ï¼‰
- åŒã˜ãƒãƒƒã‚·ãƒ¥ã‚’æŒã¤åˆ¥ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹ã«ã¯ã€**æ•°å„„å¹´ã‹ã‹ã‚‹è¨ˆç®—é‡**ãŒå¿…è¦
- ã“ã‚ŒãŒã€Œæš—å·å­¦çš„ãƒãƒƒã‚·ãƒ¥é–¢æ•°ã€ã¨å‘¼ã°ã‚Œã‚‹ç†ç”±ã§ã™

#### ã¾ã¨ã‚: ã‚¿ã‚° vs ãƒãƒƒã‚·ãƒ¥

| ä¾‹ãˆ | æŒ‡å®šæ–¹æ³• | å®‰å…¨æ€§ |
|:---|:---|:---|
| ğŸ“ ä»˜ç®‹ï¼ˆè²¼ã‚Šç›´ã—å¯èƒ½ï¼‰ | `@v4` ã‚¿ã‚° | âŒ å±é™º |
| ğŸ§¬ DNAï¼ˆå¤‰æ›´ä¸å¯èƒ½ï¼‰ | `@abc123...` ãƒãƒƒã‚·ãƒ¥ | âœ… å®‰å…¨ |

---

### ã‚¿ã‚° vs ãƒãƒƒã‚·ãƒ¥ ã®é•ã„

```yaml
# âŒ ã‚¿ã‚°æŒ‡å®šï¼ˆå±é™ºï¼‰- åŒã˜v4ã§ã‚‚ä¸­èº«ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§
- uses: actions/checkout@v4

# âœ… SHAæŒ‡å®šï¼ˆæ¨å¥¨ï¼‰- æ°¸ä¹…ã«åŒã˜ã‚³ãƒ¼ãƒ‰ã‚’æŒ‡ã™
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
```

| æŒ‡å®šæ–¹æ³• | å¤‰æ›´å¯èƒ½ï¼Ÿ | ãƒªã‚¹ã‚¯ |
|:---|:---:|:---|
| `@v4` (ã‚¿ã‚°) | âš ï¸ **å¯èƒ½** | æ”»æ’ƒè€…ãŒã‚¿ã‚°ã‚’æ›¸ãæ›ãˆå¯èƒ½ |
| `@main` (ãƒ–ãƒ©ãƒ³ãƒ) | âš ï¸ **å¯èƒ½** | å¸¸ã«æœ€æ–°ã§ä¸å®‰å®š |
| `@SHA` (ãƒãƒƒã‚·ãƒ¥) | âœ… **ä¸å¯èƒ½** | ç‰¹å®šã‚³ãƒŸãƒƒãƒˆã«å®Œå…¨å›ºå®š |

### å›³è§£: ã‚¿ã‚°ãŒå±é™ºãªç†ç”±

```mermaid
graph LR
    subgraph "ã‚¿ã‚°æŒ‡å®šã®å ´åˆ"
        T1["v4ã‚¿ã‚°"] --> C1["è‰¯ã„ã‚³ãƒ¼ãƒ‰"]
        T1 -.->|"æ”»æ’ƒè€…ãŒæ›¸ãæ›ãˆ"| C2["æ‚ªæ„ã‚ã‚‹ã‚³ãƒ¼ãƒ‰"]
    end
    subgraph "ãƒãƒƒã‚·ãƒ¥æŒ‡å®šã®å ´åˆ"
        H1["abc123..."] --> C3["è‰¯ã„ã‚³ãƒ¼ãƒ‰"]
        H1 -.->|"æ›¸ãæ›ãˆä¸å¯èƒ½"| C3
    end
```

---

## ğŸ”§ SHAã®å–å¾—æ–¹æ³•

### æ–¹æ³•1: GitHub CLIï¼ˆæ¨å¥¨ï¼‰

```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœªå°å…¥ã®å ´åˆï¼‰
brew install gh

# SHAã‚’å–å¾—ï¼ˆä¾‹: actions/checkout ã® v4.2.2ï¼‰
gh api repos/actions/checkout/git/ref/tags/v4.2.2 --jq '.object.sha'
# å‡ºåŠ›: 11bd71901bbe5b1630ceea73d27597364c9af683
```

### æ–¹æ³•2: curlã§ç›´æ¥å–å¾—

```bash
curl -s https://api.github.com/repos/actions/checkout/git/refs/tags/v4.2.2 \
  | grep '"sha"' | head -1
```

### æ–¹æ³•3: GitHubã®Webç”»é¢

1. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒªãƒã‚¸ãƒˆãƒªã¸ç§»å‹•ï¼ˆä¾‹: https://github.com/actions/checkoutï¼‰
2. ã€ŒReleasesã€ã¾ãŸã¯ã€ŒTagsã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒŸãƒƒãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯
4. URLã¾ãŸã¯ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹40æ–‡å­—ã®SHAã‚’ã‚³ãƒ”ãƒ¼

---

## ğŸ“‹ æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

| ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ãƒãƒƒã‚·ãƒ¥ |
|:---|:---:|:---|
| `actions/checkout` | v4.2.2 | `11bd71901bbe5b1630ceea73d27597364c9af683` |
| `dorny/paths-filter` | v3.0.2 | `de90cc6fb38fc0963ad72b210f1f284cd68cea36` |
| `oven-sh/setup-bun` | v2.0.2 | `735343b667d3e6f658f44d0eca948eb6282f2b76` |
| `actions/cache` | v4.2.2 | `d4323d4df104b026a6aa633fdb11d772146be0bf` |
| `astral-sh/setup-uv` | v2 | `797cf5c0a210b8b257f62fe1fbf9a46b4fc201bf` |

---

## ğŸ”„ Dependabotã§è‡ªå‹•æ›´æ–°

ãƒãƒƒã‚·ãƒ¥å›ºå®šã—ã¦ã‚‚ã€DependabotãŒè‡ªå‹•ã§æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®SHAã‚’PRã—ã¦ãã‚Œã¾ã™ã€‚

```yaml
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
```

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æ–°ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹éš›ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯:

- [ ] ã‚¿ã‚°ã§ã¯ãªãã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã§æŒ‡å®šã—ã¦ã„ã‚‹ã‹ï¼Ÿ
- [ ] ãƒãƒƒã‚·ãƒ¥ã®æ¨ªã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ã„ã‚‹ã‹ï¼Ÿï¼ˆä¾‹: `# v4.2.2`ï¼‰
- [ ] ä¿¡é ¼ã§ãã‚‹ã‚ªãƒ¼ãƒŠãƒ¼ï¼ˆ`actions/`, æœ‰åOSSï¼‰ã‹ç¢ºèªã—ãŸã‹ï¼Ÿ
- [ ] Dependabotã§è‡ªå‹•æ›´æ–°è¨­å®šã‚’ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [GitHubå…¬å¼: Using third-party actions](https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions#using-third-party-actions)
- [ãƒ¡ãƒ«ã‚«ãƒª: Codecovã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã«ã‚ˆã‚‹å½±éŸ¿ã«ã¤ã„ã¦](https://about.mercari.com/press/news/articles/20210521_incident_report/)
- [CISA: tj-actions/changed-files Supply Chain Attack](https://www.cisa.gov/news-events/alerts/2025/03/18/supply-chain-compromise-third-party-github-action-cve-2025-30066)
